<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="minimum-scale=1">
    <title>Buchführung</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="js/html2canvas.min.js"></script>
    <script src="js/js-yaml.min.js"></script>
    <script src="js/kontenplan.js"></script>
    <script src="js/clipboard.min.js"></script>
    <script src="js/menu.js"></script>
    <style>
        .taschenrechner #calc {
            background: #d33f01;
            border: 1px solid #d33f01;
            border-radius: 0.5em;
            box-shadow: inset 0 0 5px white;
            display: inline-block;
            padding: 1em 0;
            text-align: center;
            width: 240px;
            line-height: 1.5;
            font-size: medium;
        }

        .taschenrechner #calc output {
            display: block;
            height: 30px;
            background: white;
            text-align: right;
            font-size: 1.1rem;
            padding-right: 5%;
            margin: 5px 6%;
            overflow: auto;
        }

        :fullscreen #taschenrechner {
            position: absolute;
            right: 5%;
            top: 10%;
        }

        :fullscreen output {
            position: fixed;
            right: 50%;
            font-size: calc(44px + (160 - 44) * ((100vw - 320px) / (1600 - 320))) !important;
            bottom: 10%;
            transform: translateX(50%);
            width: 70%;
            height: auto !important;
            pointer-events: none;
        }

        :fullscreen #calcToggleButton {
            display: none;
        }

        #taschenrechner-fullscreen::backdrop {
            background-color: rgba(0, 0, 0, 0.5);
        }

        #taschenrechner-fullscreen {
            pointer-events: none;
        }

        output {
            pointer-events: all;
        }

        .taschenrechner #calc fieldset {
            border: none;
            margin: 0 auto;
            padding-bottom: 0;
        }

        .taschenrechner #calc button {
            cursor: pointer;
            margin: 5px 2%;
            width: 40px;
            line-height: 1.5em;
            font-size: 1em;
            white-space: nowrap;
            border: none;
            border-radius: 50%;
            color: #0f6cbf;
            aspect-ratio: 1 / 1;
            pointer-events: auto;
        }

        .taschenrechner #usage {
            display: inline-block;
            padding: 0 0 0 2em;
            vertical-align: top;
        }
    </style>

</head>
<main>
    <div w3-include-html="navigation.html"></div>
    <h2>Taschenrechner</h2>
    <div id="taschenrechnerForm" class="box">
        <div id="taschenrechner-fullscreen">
            <div id="taschenrechner" class="taschenrechner" tabindex="0">
                <form id="calc">
                    <button id="calcToggleButton"
                        style="float:right;border-radius:0;height:30px;width:30px;padding:2px;">
                        <svg xmlns="http://www.w3.org/2000/svg" height="24px" width="28px" viewBox="0 0 512 512">
                            <path
                                d="M32 32C14.3 32 0 46.3 0 64v96c0 17.7 14.3 32 32 32s32-14.3 32-32V96h64c17.7 0 32-14.3 32-32s-14.3-32-32-32H32zM64 352c0-17.7-14.3-32-32-32s-32 14.3-32 32v96c0 17.7 14.3 32 32 32h96c17.7 0 32-14.3 32-32s-14.3-32-32-32H64V352zM320 32c-17.7 0-32 14.3-32 32s14.3 32 32 32h64v64c0 17.7 14.3 32 32 32s32-14.3 32-32V64c0-17.7-14.3-32-32-32H320zM448 352c0-17.7-14.3-32-32-32s-32 14.3-32 32v64H320c-17.7 0-32 14.3-32 32s14.3 32 32 32h96c17.7 0 32-14.3 32-32V352z" />
                        </svg>
                    </button>
                    <output tabindex="0">0</output>
                    <fieldset style="clear:right;padding-top:5%;">
                        <button>√</button>
                        <button>x²</button>
                        <button>ln</button>
                        <button>C</button>
                        <button>7</button>
                        <button>8</button>
                        <button>9</button>
                        <button>+</button>
                        <button>4</button>
                        <button>5</button>
                        <button>6</button>
                        <button>-</button>
                        <button>1</button>
                        <button>2</button>
                        <button>3</button>
                        <button>×</button>
                        <button>0</button>
                        <button>.</button>
                        <button>=</button>
                        <button>÷</button>
                    </fieldset>
                </form>
            </div>
        </div>

        <p>Ein einfacher Taschnenrechner, der in Moodle bzw. in die mebis Lernplattform eingebunden werden kann.
            Grundlage ist der <a
                href="https://wiki.selfhtml.org/wiki/JavaScript/Tutorials/Taschenrechner">Taschenrechner von
                selfhtml</a>.
        </p>
        <h3>Anpassungen</h3>
        <ul>
            <li>Farbanpassung an mebis Lernplattform</li>
            <li>Vergrößerte Ansicht: Display kann zu Demonstrationszwecken per Button ein- und ausgeklappt werden</li>
        </ul>
        <h3>In Moodle integrieren</h3>
        <ul>
            <li>Sicherheitshalber eine Sicherung des Kurses erstellen (optional).</li>
            <li>Texteditor in den Einstellungen ausschalten ("Einfacher Editor").</li>
            <li>Den folgenden Code kopieren und in ein Textfeld, zum Beispiel im Seitenblock, einfügen.</li>
        </ul>
        <pre><textarea readonly="readonly" cols="80" rows="12">
            <style>
                .taschenrechner #calc {
                    background: #d33f01;
                    border: 1px solid #d33f01;
                    border-radius: 0.5em;
                    box-shadow: inset 0 0 5px white;
                    display: inline-block;
                    padding: 1em 0;
                    text-align: center;
                    width: 240px;
                    line-height: 1.5;
                    font-size: medium;
                }
        
                .taschenrechner #calc output {
                    display: block;
                    height: 30px;
                    background: white;
                    text-align: right;
                    font-size: 1.1rem;
                    padding-right: 5%;
                    margin: 5px 6%;
                    overflow: auto;
                }
        
                :fullscreen #taschenrechner {
                    position: absolute;
                    right: 5%;
                    top: 10%;
                }
        
                :fullscreen output {
                    position: fixed;
                    right: 50%;
                    font-size: calc(44px + (160 - 44) * ((100vw - 320px) / (1600 - 320))) !important;
                    bottom: 10%;
                    transform: translateX(50%);
                    width: 70%;
                    height: auto !important;
                 pointer-events: none;
                }
        
                :fullscreen #calcToggleButton {
                    display: none;
                }
        
                #taschenrechner-fullscreen::backdrop {
                    background-color: rgba(0, 0, 0, 0.5);
                }
                
                #taschenrechner-fullscreen {
                    pointer-events: none;
                }
        output {
                    pointer-events: all;
        }
        
                .taschenrechner #calc fieldset {
                    border: none;
                    margin: 0 auto;
                    padding-bottom: 0;
                }
        
                .taschenrechner #calc button {
                    cursor: pointer;
                    margin: 5px 2%;
                    width: 40px;
                    line-height: 1.5em;
                    font-size: 1em;
                    white-space: nowrap;
                    border: none;
                    border-radius: 50%;
                    color: #0f6cbf;
                    aspect-ratio: 1 / 1;
                    pointer-events: auto;
                }
        
                .taschenrechner #usage {
                    display: inline-block;
                    padding: 0 0 0 2em;
                    vertical-align: top;
                }
            </style>
        </head>
        <body>
            <div id="taschenrechner-fullscreen">
                <div id="taschenrechner" class="taschenrechner" tabindex="0">
                    <form id="calc">
                        <button id="calcToggleButton" style="float:right;border-radius:0;height:30px;width:30px;padding:2px;">
                            <svg xmlns="http://www.w3.org/2000/svg" height="24px" width="28px" viewBox="0 0 512 512">
                                <path d="M32 32C14.3 32 0 46.3 0 64v96c0 17.7 14.3 32 32 32s32-14.3 32-32V96h64c17.7 0 32-14.3 32-32s-14.3-32-32-32H32zM64 352c0-17.7-14.3-32-32-32s-32 14.3-32 32v96c0 17.7 14.3 32 32 32h96c17.7 0 32-14.3 32-32s-14.3-32-32-32H64V352zM320 32c-17.7 0-32 14.3-32 32s14.3 32 32 32h64v64c0 17.7 14.3 32 32 32s32-14.3 32-32V64c0-17.7-14.3-32-32-32H320zM448 352c0-17.7-14.3-32-32-32s-32 14.3-32 32v64H320c-17.7 0-32 14.3-32 32s14.3 32 32 32h96c17.7 0 32-14.3 32-32V352z"/>
                            </svg>
                        </button>
                        <output tabindex="0">0</output>
                        <fieldset style="clear:right;padding-top:5%;">
                            <button>√</button>
                            <button>x²</button>
                            <button>ln</button>
                            <button>C</button>
                            <button>7</button>
                            <button>8</button>
                            <button>9</button>
                            <button>+</button>
                            <button>4</button>
                            <button>5</button>
                            <button>6</button>
                            <button>-</button>
                            <button>1</button>
                            <button>2</button>
                            <button>3</button>
                            <button>×</button>
                            <button>0</button>
                            <button>.</button>
                            <button>=</button>
                            <button>÷</button>
                        </fieldset>
                    </form>
                </div>
            </div>
            <script>
    "use strict";
    document.addEventListener("DOMContentLoaded", function () {
        var form = document.getElementById("calc"),
            out = document.querySelector("#calc output"),
            overwrite = true;

        function clear() {
            event.preventDefault();
            event.stopPropagation();
            out.textContent = 0;
            overwrite = true;
        }

        function input(c) {
            event.preventDefault();
            event.stopPropagation();
            if (overwrite) {
                out.textContent = (c == "." ? "0." : c);
            } else {
                out.textContent += c;
            }
            overwrite = false;
        }

        function operator(c) {
            event.preventDefault();
            event.stopPropagation();
            out.textContent += " " + c + " ";
            overwrite = false;
        }

        function getMaxDecimalPlaces(input) {
            let maxDecimalPlaces = 0;
            let parts = input.split(/[\+\-\×\÷\*\/]/);
            parts.forEach(part => {
                let decimalPart = part.split('.')[1];
                if (decimalPart && decimalPart.length > maxDecimalPlaces) {
                    maxDecimalPlaces = decimalPart.length;
                }
            });
            return maxDecimalPlaces;
        }

        function result(noDisplay) {
            event.preventDefault();
            event.stopPropagation();
            var input = out.textContent,
                r = 0;
            input = input.replace(/×/g, "*").replace(/÷/g, "/");
            input = input.replace(/[^0-9. +\-*\/]/g, "");

            var decimalPlaces = getMaxDecimalPlaces(input);

            try {
                r = eval(input);
                r = parseFloat(r.toFixed(decimalPlaces));  // Runde das Ergebnis auf die angegebene Anzahl Dezimalstellen
            } catch (e) {
                r = 0;
            }
            if (noDisplay !== true) {
                out.textContent = r;
                overwrite = true;
            }
            return r;
        }

        if (out) {
            form.addEventListener("submit", function (ev) {
                return false;
            });
            document.querySelectorAll("#calc button").forEach(function (b) {
                var c = b.textContent;
                switch (c) {
                    case "9":
                    case "8":
                    case "7":
                    case "6":
                    case "5":
                    case "4":
                    case "3":
                    case "2":
                    case "1":
                    case "0":
                    case ".":
                        b.addEventListener("click", function () {
                            input(c);
                        });
                        break;
                    case "+":
                    case "-":
                    case "×":
                    case "÷":
                        b.addEventListener("click", function () {
                            operator(c);
                        });
                        break;
                    case "=":
                        b.addEventListener("click", result);
                        break;
                    case "C":
                        b.addEventListener("click", clear);
                        break;
                }
            });

            // Keyboard support
            document.addEventListener("keydown", function (ev) {
                // Focus must be inside the calculator
                if (!form.contains(document.activeElement)) return;

                if (ev.key === "Enter" || ev.key === "=") {
                    result();
                } else if (ev.key === "Backspace" || ev.key === "Delete") {
                    clear();
                } else if (ev.key === "c" || ev.key === "C") {
                    clear();
                } else if (!isNaN(ev.key) || ev.key === ".") {
                    input(ev.key);
                } else if (["+", "-", "*", "/"].includes(ev.key)) {
                    operator(
                        ev.key.replace("*", "×").replace("/", "÷")
                    );
                }
            });
        }
    });
            </script>
        </textarea></pre>
    </div>
</main>

<div w3-include-html="footer.html"></div>

<script>
    includeHTML();
</script>
<script>
    "use strict";
    document.addEventListener("DOMContentLoaded", function () {
        var form = document.getElementById("calc"),
            out = document.querySelector("#calc output"),
            overwrite = true;

        function clear() {
            event.preventDefault();
            event.stopPropagation();
            out.textContent = 0;
            overwrite = true;
        }

        function input(c) {
            event.preventDefault();
            event.stopPropagation();
            if (overwrite) {
                out.textContent = (c == "." ? "0." : c);
            } else {
                out.textContent += c;
            }
            overwrite = false;
        }

        function operator(c) {
            event.preventDefault();
            event.stopPropagation();
            out.textContent += " " + c + " ";
            overwrite = false;
        }

        function getMaxDecimalPlaces(input) {
            let maxDecimalPlaces = 0;
            let parts = input.split(/[\+\-\×\÷\*\/]/);
            parts.forEach(part => {
                let decimalPart = part.split('.')[1];
                if (decimalPart && decimalPart.length > maxDecimalPlaces) {
                    maxDecimalPlaces = decimalPart.length;
                }
            });
            return maxDecimalPlaces;
        }

        function result(noDisplay) {
            event.preventDefault();
            event.stopPropagation();
            var input = out.textContent,
                r = 0;
            input = input.replace(/×/g, "*").replace(/÷/g, "/");
            input = input.replace(/[^0-9. +\-*\/]/g, "");

            var decimalPlaces = getMaxDecimalPlaces(input);

            try {
                r = eval(input);
                r = parseFloat(r.toFixed(decimalPlaces));  // Runde das Ergebnis auf die angegebene Anzahl Dezimalstellen
            } catch (e) {
                r = 0;
            }
            if (noDisplay !== true) {
                out.textContent = r;
                overwrite = true;
            }
            return r;
        }

        if (out) {
            form.addEventListener("submit", function (ev) {
                return false;
            });
            document.querySelectorAll("#calc button").forEach(function (b) {
                var c = b.textContent;
                switch (c) {
                    case "9":
                    case "8":
                    case "7":
                    case "6":
                    case "5":
                    case "4":
                    case "3":
                    case "2":
                    case "1":
                    case "0":
                    case ".":
                        b.addEventListener("click", function () {
                            input(c);
                        });
                        break;
                    case "+":
                    case "-":
                    case "×":
                    case "÷":
                        b.addEventListener("click", function () {
                            operator(c);
                        });
                        break;
                    case "=":
                        b.addEventListener("click", result);
                        break;
                    case "C":
                        b.addEventListener("click", clear);
                        break;
                }
            });

            // Keyboard support
            document.addEventListener("keydown", function (ev) {
                // Focus must be inside the calculator
                if (!form.contains(document.activeElement)) return;

                if (ev.key === "Enter" || ev.key === "=") {
                    result();
                } else if (ev.key === "Backspace" || ev.key === "Delete") {
                    clear();
                } else if (ev.key === "c" || ev.key === "C") {
                    clear();
                } else if (!isNaN(ev.key) || ev.key === ".") {
                    input(ev.key);
                } else if (["+", "-", "*", "/"].includes(ev.key)) {
                    operator(
                        ev.key.replace("*", "×").replace("/", "÷")
                    );
                }
            });
        }
    });
</script>
</main>
</body>

</html>